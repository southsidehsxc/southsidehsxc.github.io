if (self.CavalryLogger) { CavalryLogger.start_js(["fp4Rq"]); }

__d("SpatialReactionConsumptionTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.clear()}h.prototype.log=function(){c("GeneratedLoggerUtils").log("logger:SpatialReactionConsumptionLoggerConfig",this.$SpatialReactionConsumptionTypedLogger1,c("Banzai").BASIC)};h.prototype.logVital=function(){c("GeneratedLoggerUtils").log("logger:SpatialReactionConsumptionLoggerConfig",this.$SpatialReactionConsumptionTypedLogger1,c("Banzai").VITAL)};h.prototype.clear=function(){this.$SpatialReactionConsumptionTypedLogger1={};return this};h.prototype.updateData=function(j){this.$SpatialReactionConsumptionTypedLogger1=babelHelpers["extends"]({},this.$SpatialReactionConsumptionTypedLogger1,j);return this};h.prototype.setCenterPitch=function(j){this.$SpatialReactionConsumptionTypedLogger1.center_pitch=j;return this};h.prototype.setCenterYaw=function(j){this.$SpatialReactionConsumptionTypedLogger1.center_yaw=j;return this};h.prototype.setDisplayState=function(j){this.$SpatialReactionConsumptionTypedLogger1.display_state=j;return this};h.prototype.setEvent=function(j){this.$SpatialReactionConsumptionTypedLogger1.event=j;return this};h.prototype.setFriendCount=function(j){this.$SpatialReactionConsumptionTypedLogger1.friend_count=j;return this};h.prototype.setHasNonFriend=function(j){this.$SpatialReactionConsumptionTypedLogger1.has_non_friend=j;return this};h.prototype.setMoveTowardsHint=function(j){this.$SpatialReactionConsumptionTypedLogger1.move_towards_hint=j;return this};h.prototype.setPitch=function(j){this.$SpatialReactionConsumptionTypedLogger1.pitch=j;return this};h.prototype.setReactionKey=function(j){this.$SpatialReactionConsumptionTypedLogger1.reaction_key=j;return this};h.prototype.setVideoTimestamp=function(j){this.$SpatialReactionConsumptionTypedLogger1.video_timestamp=j;return this};h.prototype.setYaw=function(j){this.$SpatialReactionConsumptionTypedLogger1.yaw=j;return this};var i={center_pitch:true,center_yaw:true,display_state:true,event:true,friend_count:true,has_non_friend:true,move_towards_hint:true,pitch:true,reaction_key:true,video_timestamp:true,yaw:true};f.exports=h}),null);
__d("ChooseLove",["cx","Arbiter","DOM","DOMVector","FeedbackReactionType","Random","Style","UFIUIEvents"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=null;function j(m){__p&&__p();var n=c("DOM").create("div",{className:"_7nz"}),o=c("DOM").create("div",{className:"_7n-"}),p=c("DOM").create("div",{className:"_7n_"});o.appendChild(p);n.appendChild(o);var q=parseInt(c("Random").random()*90-45,10),r=parseInt(c("Random").random()*250+150,10),s=c("Random").random()+.25,t=m/100+.25;c("Style").set(n,"transform","rotate("+q+"deg)");c("Style").set(o,"transition-duration",t+"s");var u=function u(){c("Style").set(n,"transform","rotate("+q+"deg) translateY("+-r+"px)");c("Style").set(o,"transform","scale(0)");c("Style").set(p,"transform","scale("+s+")")};return[n,u]}var k=function k(m,n){__p&&__p();if(n.reaction_type!=c("FeedbackReactionType").LOVE)return;var o=c("DOMVector").getElementPosition(n.target),p=c("DOMVector").getElementDimensions(n.target),q=c("DOM").create("div"),r=[];for(var s=0;s<50;s++){var t=j(s);q.appendChild(t[0]);r.push(t[1])}var u=o.add(p.div(2)),v=c("DOM").create("div",{className:"_lqb",style:"left: "+(u.x-24)+"px;top: "+(u.y-14)+"px"},[q]);document.body.appendChild(v);setTimeout(function(){while(r.length)r.shift()();setTimeout(function(){c("DOM").remove(v)},2125)},0)},l={enableExplosions:function m(){if(i)return;i=c("Arbiter").subscribe(c("UFIUIEvents").ReactionButtonClicked,k)},disableExplosions:function m(){i&&i.unsubscribe();i=null}};f.exports=l}),null);
__d("UFIReactionsDialogLayerImpl.react",["cx","csx","BrowserSupport","ChooseLove","CSS","DataStore","DOM","DOMQuery","Focus","Layer","Locale","Parent","React","ReactDOM","ReactTransitionEvents","RTLKeys","Style","SubscriptionsHandler","TabbableElements","UFIConfig","Vector","ViewportBounds","ge","getElementPosition","getOverlayZIndex","memoize","renderSubtreeIntoContainer","requestAnimationFrame"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j,k,l,m,n=c("React").PropTypes,o="_1oxh",p="_2r6k",q="_2r6j",r=c("BrowserSupport").hasCSSAnimations(),s="_22uo",t={};j=babelHelpers.inherits(u,c("Layer"));k=j&&j.prototype;u.prototype.updatePosition=function(){"use strict";__p&&__p();var w=this.getInsertParent(),x=this.getCausalElement(),y=c("Vector").getElementPosition(x),z=c("Vector").getElementPosition(w),A=y.sub(z),B=c("Vector").getElementDimensions(w).x;if(c("Locale").isRTL())A.x=B-A.x;var C=c("Vector").getViewportDimensions().x,D=c("Vector").getElementDimensions(this.getContentRoot()).x;A.x=Math.min(A.x,C-D);if(c("Locale").isRTL())t.right=A.x+"px";else t.left=A.x+"px";t.top=A.y+"px";t.zIndex=this._getZIndex(x,w);c("Style").apply(this.getRoot(),t);return true};u.prototype._getZIndex=function(w,x){"use strict";__p&&__p();var y=c("getOverlayZIndex")(w,x),z=c("Parent").byClass(x,"fbPhotoSnowliftContainer"),A=z&&c("DOMQuery").scry(z,".stageWrapper")[0];if(A)y=Math.max(y,c("getOverlayZIndex")(A,z));var B=c("ge")("pagelet_sidebar");if(B){var C=c("DOMQuery").scry(B,".fbChatSidebar")[0];if(C)y=Math.max(y,parseInt(c("Style").get(C,"z-index"),10)+1)}return y};u.prototype.getContentRoot=function(){"use strict";return this.contentRoot};u.prototype._buildWrapper=function(w,x){"use strict";c("CSS").addClass(x,"_49v-");this.contentRoot=x;if(c("UFIConfig").showChooseLoveAnimation)c("ChooseLove").enableExplosions();var y=document.createElement("div");c("CSS").addClass(y,"_1oxj");y.appendChild(x);return y};function u(){"use strict";j.apply(this,arguments)}l=babelHelpers.inherits(v,c("React").Component);m=l&&l.prototype;function v(w,x){"use strict";__p&&__p();m.constructor.call(this,w,x);this.onTransitionHide=function(){c("ReactTransitionEvents").removeEndEventListener(this.layer.getContentRoot(),this.onTransitionHide);this.finishHide()}.bind(this);this.onTransitionShow=function(){var y=this.layer.getContentRoot();c("ReactTransitionEvents").removeEndEventListener(y,this.onTransitionShow);c("requestAnimationFrame")(function(){c("CSS").removeClass(y,q)})}.bind(this);this.onKeyDown=function(event){__p&&__p();var y=event.keyCode;if(this.props.isScreenReader)return;if(y===c("RTLKeys").ESC||y===c("RTLKeys").RETURN||y===c("RTLKeys").TAB){this.props.onLayerBlur&&this.props.onLayerBlur(event);var z=c("ReactDOM").findDOMNode(this.refs.root),A=c("TabbableElements").find(this.getContextualLayerParent()),B=null,C=[],D=y===c("RTLKeys").TAB&&event.shiftKey;for(var E=0;E<A.length;E++)if(A[E].tabIndex>-1){if(z.compareDocumentPosition(A[E])&4){B=A[E];break}if(D)C.push(A[E])}if(C.length)B=C[C.length-1];if(B){c("Focus").set(B);event.preventDefault();event.stopPropagation()}}}.bind(this);this.getGlobalContainer=c("memoize")(function(){return c("ge")("globalContainer")});this.onParentLayerHide=this.finishHide.bind(this);this.dockAnimation=s}v.prototype.componentDidMount=function(){"use strict";__p&&__p();var w=c("ReactDOM").findDOMNode(this.refs.root);this.layer=new u({causalElement:w,insertParent:w},document.createElement("div"));c("DOM").appendContent(w,this.layer.getRoot());this.handler=new(c("SubscriptionsHandler"))();if(this.props.onLayerBlur)this.handler.addSubscriptions(this.layer.subscribe("blur",this.props.onLayerBlur));this.handler.addSubscriptions(this.layer.subscribe("beforeshow",this.beforeShow.bind(this)),this.layer.subscribe("aftershow",this.afterShow.bind(this)),this.layer.subscribe("starthide",this.startHide.bind(this)));if(this.isInDocument())this.renderLayer()};v.prototype.componentDidUpdate=function(w){"use strict";this.renderLayer()};v.prototype.componentWillUnmount=function(){"use strict";__p&&__p();if(this.layer){var w=this.layer.getContentRoot();c("ReactDOM").unmountComponentAtNode(this.layer.getContentRoot());c("ReactTransitionEvents").removeEndEventListener(w,this.onTransitionHide);c("ReactTransitionEvents").removeEndEventListener(w,this.onTransitionShow);this.handler.release();this.handler=null;this.layer.destroy();this.layer=null}};v.prototype.isInDocument=function(){"use strict";var w=c("ReactDOM").findDOMNode(this.refs.root);return w&&document.body.contains(w)};v.prototype.afterShow=function(){"use strict";__p&&__p();c("CSS").removeClass(this.refs.root,"accessible_elem");var w=this.layer.getContentRoot(),x=c("getElementPosition")(w).y,y=c("ViewportBounds").getTop();c("CSS").conditionClass(w,o,x&&x<y);if(r){c("ReactTransitionEvents").addEndEventListener(w,this.onTransitionShow);c("CSS").addClass(w,this.dockAnimation);c("CSS").addClass(w,q)}var z=c("TabbableElements").find(this.layer.getContentRoot())[0];z&&z.focus()};v.prototype.beforeShow=function(){"use strict";var w=this.getContextualLayerParent();if(this.props.isScreenReader)this.layer.setInsertParent(this.layer.getCausalElement());else if(w!==this.layer.getInsertParent()){this.layer.setInsertParent(w);this.setParentLayerSubscription(w)}};v.prototype.setParentLayerSubscription=function(w){"use strict";__p&&__p();if(w!==this.getGlobalContainer()){this.parentLayerSubscription&&this.parentLayerSubscription.unsubscribe();this.parentLayer=null;return}var x=w,y=null;while(x!==null){y=c("DataStore").get(x,"layer");if(y)break;x=x.parentNode}if(y&&y!==this.parentLayer){this.parentLayerSubscription&&this.parentLayerSubscription.unsubscribe();this.parentLayerSubscription=y.subscribe("hide",this.onParentLayerHide);this.parentLayer=y}};v.prototype.startHide=function(){"use strict";if(r&&this.isInDocument()){var w=this.layer.getContentRoot();c("ReactTransitionEvents").addEndEventListener(w,this.onTransitionHide);c("CSS").addClass(w,p)}else this.finishHide();return false};v.prototype.finishHide=function(){"use strict";__p&&__p();c("CSS").addClass(this.refs.root,"accessible_elem");var w=this.layer.getContentRoot();if(r){c("CSS").removeClass(w,o);c("CSS").removeClass(w,p);c("CSS").removeClass(w,this.dockAnimation)}this.layer.setInsertParent(this.layer.getCausalElement());this.layer.finishHide()};v.prototype.getContextualLayerParent=function(){"use strict";var w=c("ReactDOM").findDOMNode(this.refs.root);if(w instanceof Element){var x=c("Parent").byClass(w,"uiContextualLayerParent");if(x instanceof HTMLElement)return x}return document.body};v.prototype.renderLayer=function(){"use strict";c("renderSubtreeIntoContainer")(this,c("React").createElement("div",babelHelpers["extends"]({},this.props,{className:"_1oxk",onKeyDown:this.onKeyDown,role:"presentation"}),this.props.children,c("React").createElement("div",{className:"_41nt"+(this.props.isDarkBackground?" _3_jc":"")+(this.props.noBackground?" hidden_elem":""),style:{height:this.props.height}})),this.layer.getContentRoot(),function(){this.props.onLayerRender&&this.props.onLayerRender()}.bind(this));this.layer.conditionShow(this.props.shown)};v.prototype.render=function(){"use strict";return c("React").createElement("div",{className:"_2r6l accessible_elem",ref:"root"})};v.propTypes={shown:n.bool,isScreenReader:n.bool,onLayerRender:n.func};f.exports=v}),null);
__d("SpatialReactionAnimationConfig",["CubicBezier"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=60,i=function i(o,p,q,r){return{solve:function s(t,u,v,w){var x=new(c("CubicBezier"))([o,p],[q,r]);return v*x.solve(t/w)+u}}},j={solve:function o(p,q,r,s){return p/s*r+q}},k=function k(o){return{solve:function p(q,r,s,t,u){if(q<u)return r;else return o.solve(q-u,r,s,t-u)}}},l=function l(o){return{solve:function p(q,r,s,t,u){if(q<t-u)return o.solve(q,r,s,t-u);else return r+s}}},m=function m(o){return{solve:function p(q,r,s,t,u,v){if(u+v>t)throw new Error("Delay exceeds total steps");if(q<u)return r;else if(q>=t-v)return r+s;else return o.solve(q-u,r,s,t-u-v)}}},n={CLICK:{NUM_POSITIONS:2,LEFT_RIGHT_MARGIN:{PERCENT:.1}},CURVES:{MOVE_TO_CENTER_SCALE:i(.25,0,.58,1.02),MOVE_TO_CENTER_PATH_X:i(.3,.3,.5,1),MOVE_TO_CENTER_PATH_Y:i(0,.75,.9,.8),LOOK_AT_CENTER_PATH_X:l(i(.2,.2,.3,1)),LOOK_AT_CENTER_PATH_Y:l(i(.2,.2,.6,1)),LOOK_AT_CENTER_SCALE_SELF:m(i(0,.7,.6,1)),LOOK_AT_CENTER_SCALE_NON_SELF:m(i(.9,0,.25,1)),LOOK_AT_CENTER_FACE_POSITION:j,LOOK_AT_CENTER_FACE_SCALE_X:j,FACE_FLIP:m(j),MOVE_BACK_TOWARD_CENTER_PATH_X:i(.4,0,0,.8),MOVE_BACK_TOWARD_CENTER_PATH_Y:i(.4,.6,0,1),MOVE_BACK_TOWARD_CENTER_SCALE:m(i(.9,0,.25,1)),MOVE_BACK_TOWARD_CENTER_FACE_SCALE_X:m(j)},DRAG:{THROTTLE_INTERVAL:{MS:200},THRESHOLD:{MS:200},FRICTION_COEFFICIENT:.15,ORIGINAL_SCALE_VALUE:"scale(0.8)",VELOCITY:{MAX:600},FACE:{OFFSET:{LOVE:{PX:15}},SCALE:{MIN:.85}}},DURATIONS:{SELF:{TOTAL:{SECONDS:2.15,FRAMES:2.15*h},MOVE_TO_CENTER:{SECONDS:.35,FRAMES:.35*h},LOOK_AT_CENTER:{SECONDS:.7,FRAMES:.7*h,MAX_RANDOM_DELAY_FRAMES:0*h,MIN_RANDOM_SCALE_DELAY_FRAMES:0*h,MAX_RANDOM_SCALE_DELAY_FRAMES:0*h},MOVE_BACK_TOWARD_CENTER:{SECONDS:1.1,FRAMES:1.1*h,MAX_RANDOM_SCALE_DELAY_FRAMES:.95*h},SCALE_DOWN:{SECONDS:.15,FRAMES:.15*h},SCALE_UP:{SECONDS:.15,FRAMES:.15*h},FACE_FLIP:{SECONDS:.15,FRAMES:.15*h},FACE_HANG:{SECONDS:.2,FRAMES:.2*h}},NON_SELF:{TOTAL:{SECONDS:2,FRAMES:2*h},MOVE_TO_CENTER:{SECONDS:0,FRAMES:0*h},LOOK_AT_CENTER:{SECONDS:1.5,FRAMES:1.5*h,MAX_RANDOM_DELAY_FRAMES:.8*h,MIN_RANDOM_SCALE_DELAY_FRAMES:.3*h,MAX_RANDOM_SCALE_DELAY_FRAMES:1.35*h},MOVE_BACK_TOWARD_CENTER:{SECONDS:.5,FRAMES:.5*h,MAX_RANDOM_SCALE_DELAY_FRAMES:.35*h},SCALE_DOWN:{SECONDS:.15,FRAMES:.15*h},SCALE_UP:{SECONDS:.15,FRAMES:.15*h},FACE_FLIP:{SECONDS:.15,FRAMES:.15*h},FACE_HANG:{SECONDS:.2,FRAMES:.2*h}}},SHADOW:{COLOR:"rgba(0, 0, 0, 0.4)",BLUR:70,OFFSET_X:6,OFFSET_Y:6},SIZES:{BASE:{PX:38},PROFILE:{PX:34},FACE:{PX:38}},OPACITY:{MAX:1,MIN:0},SCALES:{COIN_FLIP_MORPH_START:.7,MOVE_TO_CENTER:{MIN:.6,MAX:1},LOOK_AT_CENTER:{MIN:.6,MID:.8,MAX:1,SELF_MIN:0},LOOK_AT_CENTER_FACE_X:{MAX:1,MIN:.8},MOVE_BACK_TOWARD_CENTER:{MAX:1,MIN:0}},DISTANCES:{LOOK_AT_CENTER:{SELF:{X:{PX:125},Y:{PX:100}},NON_SELF:{X:{PX:185},Y:{PX:100}},RANDOM_OFFSET_X:{MIN:{PX:-10},MAX:{PX:40}}},MOVE_BACK_TOWARD_CENTER:{X:{PX:40},Y:{PX:30}},MAX_FACE_OFFSET:{PX:6},FACE_FLIP_OUT_OFFSET:{PX:30},MAX_PROFILE_PICTURE_OFFSET:{PX:38}}};f.exports=n}),null);
__d("SpatialReactionExperimentsStore",["SphericalVideoComponentConstants","SphericalVideoComponentDispatcher","FluxMapStore","immutable","idx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j,k;h=babelHelpers.inherits(l,c("immutable").Record({viewportLimiting:""}));i=h&&h.prototype;function l(){h.apply(this,arguments)}j=babelHelpers.inherits(m,c("FluxMapStore"));k=j&&j.prototype;m.prototype.getInitialState=function(){return c("immutable").Map({})};m.prototype.reduce=function(n,o){var p=o.id;switch(o.type){case c("SphericalVideoComponentConstants").ACTIONS.REGISTER_EXPERIMENT_CONFIG:var q=o.config;n=n.set(p,new l(babelHelpers["extends"]({},q)));break;default:break}return n};m.prototype.shouldDisableReactions=function(n){var o,p=this.getState().get(n);return((o=p)!=null?o.viewportLimiting:o)==="none"};m.prototype.shouldDisableInitialViewportReactions=function(n){var o,p=this.getState().get(n);return((o=p)!=null?o.viewportLimiting:o)==="no_initial_viewport"};m.prototype.shouldOnlyShowHints=function(n){var o,p=this.getState().get(n);return((o=p)!=null?o.viewportLimiting:o)==="hint_only"};function m(){j.apply(this,arguments)}f.exports=new m(c("SphericalVideoComponentDispatcher"))}),null);
__d("SpatialReactionLoggingConstants",[],(function a(b,c,d,e,f,g){"use strict";var h={FUNNEL_ACTIONS:{CLICK_LIKE:"click_like",OPEN_REACTION_MENU:"open_reaction_menu",CLICK_REACTION:"click_reaction",CLOSE_REACTION_MENU:"close_reaction_menu",PICK_UP_REACTION:"pick_up_reaction",RELEASE_REACTION_ON_VIDEO:"relase_reactions_on_video",RELEASE_REACTION_SOMEWHERE_ELSE:"release_reaction_somewhere_else"},FUNNEL_NAME:"WWW_SPATIAL_REACTION_PRODUCTION_FUNNEL",PLAY_TAG:"video_is_playing",PAUSE_TAG:"video_is_paused",CONSUMPTION_DISPLAY_STATES:{DISPLAY:0,HINT:1,OUT_OF_VIEWPORT:2,DISABLED:3}};f.exports=h}),null);
__d("SpatialReaction",["FeedbackReactionType","immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("immutable").Record({animationRandomSeed:0,isFriend:false,profilePictureURI:null,reactionType:c("FeedbackReactionType").LIKE,positionIndex:-1});h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("SpatialReactionClusterBase",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=c("immutable").Record({animationDurationFrames:-1,animationPitch:null,animationProgressFrames:-1,animationYaw:null,anonymousReactions:c("immutable").Set(),friendReactions:c("immutable").Set(),isHint:false,isSelfReaction:false,originalPitch:0,originalYaw:0,timestamp:-1});h=babelHelpers.inherits(k,j);i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("SpatialReactionCluster",["SpatialReactionClusterBase"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("SpatialReactionClusterBase"));i=h&&h.prototype;j.prototype.hasStartedAnimating=function(){return this.animationProgressFrames>=0};j.prototype.startAnimation=function(k,l){var m=arguments.length<=2||arguments[2]===undefined?false:arguments[2];return this.set("animationProgressFrames",0).set("isHint",m).set("animationYaw",k).set("animationPitch",l)};j.prototype.stopAnimation=function(){return this.set("animationProgressFrames",-1).set("isHint",false)};j.prototype.tickAnimation=function(){var k=this.animationProgressFrames;return this.set("animationProgressFrames",k+1)};j.prototype.isAnimationFinished=function(){return this.animationProgressFrames>=this.animationDurationFrames};function j(){h.apply(this,arguments)}f.exports=j}),null);
__d("denormalizeYaw",[],(function a(b,c,d,e,f,g){function h(i){var j=arguments.length<=1||arguments[1]===undefined?false:arguments[1],k=j?Math.PI:180,l=k*2;return i<=0?i+l:i}f.exports=h}),null);
__d("SpatialReactionsUtils",["csx","invariant","Alea","SpatialReactionAnimationConfig","DOM","DOMClone","DOMQuery","immutable","Rect","SpatialReaction","Scroll","Style","Vector","SpatialReactionCluster","VideoChannel","denormalizeYaw","getElementPosition"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j={processServerReactionsPayloads:function k(l){__p&&__p();var m=c("immutable").Set();for(var n=l,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{p=n.next();if(p.done)break;q=p.value}var r=q;m=m.add(j.createSpatialReactionClusterFromData(r))}return m},createSpatialReactionClusterFromData:function k(l){var m=l.yaw,n=l.pitch,o=l.timestamp;m=c("denormalizeYaw")(m);var p=0,q=c("SpatialReactionAnimationConfig").DURATIONS.NON_SELF.TOTAL.FRAMES,r=new(c("Alea"))(m+n+o+""),s=l.friend_reactions.reduce(function(u,v){return u.add(new(c("SpatialReaction"))({animationRandomSeed:r(),reactionType:v.reaction_type,profilePictureURI:v.profile_picture_uri,isFriend:true,positionIndex:p++}))},c("immutable").Set()),t=l.popular_reactions.reduce(function(u,v){return u.add(new(c("SpatialReaction"))({animationRandomSeed:r(),reactionType:v.reaction_type,positionIndex:p++}))},c("immutable").Set());return new(c("SpatialReactionCluster"))({animationDurationFrames:q,anonymousReactions:t,friendReactions:s,originalPitch:n,originalYaw:m,timestamp:o})},getFriendReaction:function k(l){var m=null,n=l.feedback_add_streaming_reaction_subscribe;if(n.reactor.is_viewer_friend)m={profilePictureURI:n.reactor.profile_picture.uri,reactionType:n.reaction_info.reaction_type,reactionRegionId:this._getMostRecentlyActiveRegionId(n.regional_spatial_reaction_counts)};return m},_getMostRecentlyActiveRegionId:function k(l){l.length>0||i(0);var m=l[0];return m.region_id},fetchNewLiveReactions:function k(l,m,n,o){__p&&__p();if(n.length===0)return null;var p=j.getMostActiveRegion(n,m);if(!p)return null;var q=0,r=c("immutable").Set(),s={},t=null,u=Math.ceil(l);if(o){s=j.getPitchAndYawFromRegionId(o.reactionRegionId);t=new(c("Alea"))(s.pitch+s.yaw+u);r=r.add(new(c("SpatialReaction"))({animationRandomSeed:t(),reactionType:o.reactionType,profilePictureURI:o.profilePictureURI,isFriend:true,positionIndex:q++}))}else s=j.getPitchAndYawFromRegionId(p.region_id);var v=c("SpatialReactionAnimationConfig").DURATIONS.NON_SELF.TOTAL.FRAMES,w=s,x=w.pitch,y=w.yaw;if(!t)t=new(c("Alea"))(y+x+u);if(p){var z=j.getAnonymousReactions(p,m,q,t);return c("immutable").Set().add(new(c("SpatialReactionCluster"))({animationDurationFrames:v,anonymousReactions:z,friendReactions:r,originalPitch:x,originalYaw:y,timestamp:u}))}return null},updateReactionRegionMap:function k(l,m){return l.reduce(function(n,o){var p=o.region_id,q=o.region_reaction_counts.reduce(function(r,s){return r.set(s.reaction_type,s.count)},c("immutable").Map());return n.set(p,q)},c("immutable").Map())},getAnonymousReactions:function k(l,m,n,o){__p&&__p();var p=m.get(l.region_id),q=l.region_reaction_counts,r=c("immutable").Set(),s=c("immutable").Map();if(p&&!p.isEmpty())for(var t=q,u=Array.isArray(t),v=0,t=u?t:t[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var w;if(u){if(v>=t.length)break;w=t[v++]}else{v=t.next();if(v.done)break;w=v.value}var x=w,y=p.get(x.reaction_type),z=x.count-y;if(z>0)s=s.set(x.reaction_type,z)}else s=q.reduce(function(C,x){if(x.count>0)return C.set(x.reaction_type,x.count);else return C},c("immutable").Map());var A=s.sort().toMap(),B=A.slice(0,q.length-n);r=B.reduce(function(C,D,E){return C.add(new(c("SpatialReaction"))({animationRandomSeed:o(),reactionType:E,positionIndex:n++}))},c("immutable").Set());return r},getPitchAndYawFromRegionId:function k(l){var m=10,n=l%(360/m),o=l-n,p=n*m;p-=180;p=p===0?p:c("denormalizeYaw")(p);var q=o/(360/m);q*=m;q-=90;p+=m/2;q+=m/2;return{yaw:p,pitch:q}},getMostActiveRegion:function k(l,m){__p&&__p();var n=null,o=0;for(var p=l,q=Array.isArray(p),r=0,p=q?p:p[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var s;if(q){if(r>=p.length)break;s=p[r++]}else{r=p.next();if(r.done)break;s=r.value}var t=s,u=t.region_id,v=0,w=t.region_reaction_counts,x=w.reduce(function(A,B){return A+B.count},0),y=m.get(u);if(y){var z=y.reduce(function(A,B){return A+B},0);v=x-z}else v=x;if(v>o){o=v;n=t}}return n},getChannelViewViewportRect:function k(){if(c("VideoChannel").get())return new(c("Rect"))(c("DOMQuery").find(c("VideoChannel").get().getDialogContent(),"._1kfk"));else throw new Error("Not currently in channel view")},isVectorWithinViewport:function k(l,m,n){return!(l.x>m||l.x<0||l.y>n||l.y<0)},getRootElement:function k(){return c("DOM").find(document.body,"._li")},getReactionCenterVector:function k(l){var m=c("SpatialReactionAnimationConfig").SIZES.BASE.PX/2,n=c("getElementPosition")(l);return new(c("Vector"))(n.x+m+c("Scroll").getLeft(document.body),n.y+m+c("Scroll").getTop(document.body),"document")},insertOnTop:function k(l,m){var n=arguments.length<=2||arguments[2]===undefined?0:arguments[2],o=j.getRootElement(),p=l.getBoundingClientRect(),q=c("Scroll").getTop(document.body),r=p.top-p.width+q,s=p.left;c("DOM").insertAfter(o,m);c("Style").set(m,"position","absolute");c("Style").set(m,"left",s+"px");c("Style").set(m,"top",r-n+"px");c("Style").set(m,"z-index","1000")},cloneNode:function k(l){return c("DOMClone").deepClone(l)},hashId:function k(l){var m=0;if(l.length===0)return m;for(var n=0;n<l.length;n++){var o=l.charCodeAt(n);m=(m<<5)-m+o;m&=m}return m}};f.exports=j}),null);
__d("SpatialReactionFunnelLoggingStore",["SphericalVideoComponentConstants","SpatialReactionLoggingConstants","SphericalVideoComponentDispatcher","FluxReduceStore","FunnelLogger","VideoPlayerControllerStore","curry","SpatialReactionsUtils"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("SphericalVideoComponentConstants").ACTIONS,k=c("SpatialReactionsUtils").hashId;h=babelHelpers.inherits(l,c("FluxReduceStore"));i=h&&h.prototype;l.prototype.getInitialState=function(){return{}};l.prototype.reduce=function(m,n){__p&&__p();var o=n.id,p=c("curry")(this.$SpatialReactionFunnelLoggingStore1,o);switch(n.type){case j.CLICK_LIKE_BUTTON:this.$SpatialReactionFunnelLoggingStore2(o);p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.CLICK_LIKE);this.$SpatialReactionFunnelLoggingStore3(o);break;case j.OPEN_REACTION_MENU:this.$SpatialReactionFunnelLoggingStore2(o);p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.OPEN_REACTION_MENU);break;case j.CLOSE_REACTION_MENU:p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.CLOSE_REACTION_MENU);this.$SpatialReactionFunnelLoggingStore3(o);break;case j.CLICK_REACTION:p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.CLICK_REACTION);this.$SpatialReactionFunnelLoggingStore3(o);break;case j.SET_MOUSE_DOWN:p(c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.PICK_UP_REACTION);break;case j.DROP_REACTION:if(n.recordMouseLocation){p(n.reactionOutsideViewport?c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.RELEASE_REACTION_SOMEWHERE_ELSE:c("SpatialReactionLoggingConstants").FUNNEL_ACTIONS.RELEASE_REACTION_ON_VIDEO);this.$SpatialReactionFunnelLoggingStore3(o)}break;default:break}return m};l.prototype.$SpatialReactionFunnelLoggingStore2=function(m){var n=k(m),o=c("VideoPlayerControllerStore").getIsPlaying(m),p=o?c("SpatialReactionLoggingConstants").PLAY_TAG:c("SpatialReactionLoggingConstants").PAUSE_TAG;c("FunnelLogger").startFunnel(c("SpatialReactionLoggingConstants").FUNNEL_NAME,n);c("FunnelLogger").addFunnelTag(c("SpatialReactionLoggingConstants").FUNNEL_NAME,n,p)};l.prototype.$SpatialReactionFunnelLoggingStore3=function(m){var n=k(m);c("FunnelLogger").endFunnel(c("SpatialReactionLoggingConstants").FUNNEL_NAME,n)};l.prototype.$SpatialReactionFunnelLoggingStore1=function(m,n){var o=k(m);c("FunnelLogger").appendAction(c("SpatialReactionLoggingConstants").FUNNEL_NAME,o,n)};function l(){h.apply(this,arguments)}f.exports=new l(c("SphericalVideoComponentDispatcher"))}),null);
__d("SpatialReactionConsumptionLoggingEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({SPATIAL_REACTION_DISPLAY:"spatial_reaction_display"})}),null);
__d("SpatialReactionDisplayStates",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({DISPLAY:0,HINT:1,OUT_OF_VIEWPORT:2,DISABLED:3})}),null);
__d("SpatialReactionAnimationUtils",["Promise","SpatialReactionAnimationConfig","CSS","Style","Vector","FeedbackReactionType","SphericalProjectionUtils","SpatialReactionsUtils","getVendorPrefixedEventName","setInterval"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SpatialReactionAnimationConfig").CURVES,i=h.LOOK_AT_CENTER_FACE_POSITION,j=h.LOOK_AT_CENTER_FACE_SCALE_X,k=h.FACE_FLIP,l=h.MOVE_BACK_TOWARD_CENTER_FACE_SCALE_X,m=c("getVendorPrefixedEventName")("animationend"),n=c("getVendorPrefixedEventName")("transitionend"),o=10,p={canStartClusterAnimation:function q(r,s,t){__p&&__p();var u=s.friendReactions.union(s.anonymousReactions),v=function v(x,y){var z=y.profilePictureURI,A=y.reactionType;if(z){var B=t.hasFriendImage(z);x=x&&B}var C=t.hasReactionBaseImage(A)&&t.hasReactionFaceImage(A);x=x&&C;return x},w=u.reduce(v,true);return p.clusterIsWithinOneSecond(r,s.timestamp)&&!s.hasStartedAnimating()&&w},resetClusterAnimationIfNeeded:function q(r){return r.isAnimationFinished()?p.resetClusterAnimation(r):r},resetClusterAnimation:function q(r){var s=p.convertToNonSelfAnimation;return s(r.stopAnimation())},convertToNonSelfAnimation:function q(r){if(r.isSelfReaction){var s=c("SpatialReactionAnimationConfig").DURATIONS.NON_SELF.TOTAL.FRAMES;r=r.set("isSelfReaction",false);r=r.set("animationDurationFrames",s)}return r},getReactionBaseSize:function q(r){return Math.floor(c("SpatialReactionAnimationConfig").SIZES.BASE.PX*r)},getReactionRadius:function q(r){return Math.floor(c("SpatialReactionAnimationConfig").SIZES.BASE.PX/2*r)},getProfilePictureRadius:function q(r){return Math.floor(c("SpatialReactionAnimationConfig").SIZES.PROFILE.PX/2*r)},getReactionIndexOnLeft:function q(r){return r.positionIndex%2===0},getReactionFaceDimensions:function q(r,s,t){__p&&__p();var u=p.getDurationsForClusterType,v=p.getClusterIsLookingAtCenter,w=p.getLookAtCenterProgressFrames,x=p.getClusterIsMovingBackTowardCenter,y=p.getMoveBackTowardCenterProgressFrames,z=1,A=1,B=c("SpatialReactionAnimationConfig").SIZES.FACE.PX,C=c("SpatialReactionAnimationConfig").SCALES.LOOK_AT_CENTER_FACE_X.MIN,D=c("SpatialReactionAnimationConfig").SCALES.LOOK_AT_CENTER_FACE_X.MAX,E=u(r,c("SpatialReactionAnimationConfig")),F=E.LOOK_AT_CENTER.FRAMES;if(v(r)){var G=w(r);z=j.solve(G,D,-(D-C),F)}else if(x(r)){var H=E.MOVE_BACK_TOWARD_CENTER.FRAMES,I=E.SCALE_DOWN.FRAMES,J=y(r),K=c("SpatialReactionAnimationConfig").SCALES.MOVE_BACK_TOWARD_CENTER.MIN,L=c("SpatialReactionAnimationConfig").SCALES.LOOK_AT_CENTER_FACE_X.MAX,M=E.MOVE_BACK_TOWARD_CENTER.MAX_RANDOM_SCALE_DELAY_FRAMES,N=Math.floor(s.animationRandomSeed*M),O=H-N-I;z=l.solve(J,L,-(L-K),H,N,O)}return new(c("Vector"))(Math.floor(B*t*z),Math.floor(B*t*A))},clusterIsWithinOneSecond:function q(r,s){var t=s-.5,u=s+.5;return r>t&&r<u},getPercentageWithOffset:function q(r,s,t){return(s-r)/(t-r)},getPercentageWithMax:function q(r,s){return Math.min(r,s)/s},getDurationsForClusterType:function q(r,s){return r.isSelfReaction?s.DURATIONS.SELF:s.DURATIONS.NON_SELF},getMoveToCenterProgressFrames:function q(r){if(!r.isSelfReaction)throw new Error("Non self clusters do not move to center");else{var s=c("SpatialReactionAnimationConfig").DURATIONS,t=s.SELF.MOVE_TO_CENTER.FRAMES,u=r.animationProgressFrames;if(u<0||u>=t)throw new Error("Animation progress value not in move to center range: "+u);return u}},getLookAtCenterProgressFrames:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),u=t.LOOK_AT_CENTER.FRAMES,v=t.MOVE_TO_CENTER.FRAMES,w=s-v;if(w<0||w>=u)throw new Error("Animation progress value not in look at center range: "+w);return w},getMoveBackTowardCenterProgressFrames:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),u=t.MOVE_BACK_TOWARD_CENTER.FRAMES,v=t.MOVE_TO_CENTER.FRAMES+t.LOOK_AT_CENTER.FRAMES,w=s-v;if(w<0||w>=u)throw new Error("Animation progress value not in face flip range: "+w);return w},getClusterIsMovingToCenter:function q(r){var s=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),t=s.MOVE_TO_CENTER.FRAMES;return r.isSelfReaction&&r.hasStartedAnimating()&&r.animationProgressFrames<t},getClusterIsLookingAtCenter:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),u=t.MOVE_TO_CENTER.FRAMES,v=u+t.LOOK_AT_CENTER.FRAMES;return s>=u&&s<v},getClusterIsMovingBackTowardCenter:function q(r){var s=r.animationProgressFrames,t=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),u=t.MOVE_TO_CENTER.FRAMES+t.LOOK_AT_CENTER.FRAMES,v=u+t.MOVE_BACK_TOWARD_CENTER.FRAMES;return s>=u&&s<v},getReactionFaceOffset:function q(r,s){var t=p.getClusterIsLookingAtCenter,u=p.getClusterIsMovingBackTowardCenter,v=p.getLookAtCenterProgressFrames,w=p.getReactionIndexOnLeft,x=w(s),y=0,z=c("SpatialReactionAnimationConfig").DISTANCES.MAX_FACE_OFFSET.PX*(x?1:-1);if(t(r)){var A=v(r),B=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),C=B.LOOK_AT_CENTER.FRAMES;return i.solve(A,y,z,C)}else if(u(r))return z;else return y},getReactionFaceFlipOutOffset:function q(r,s){var t=p.getClusterIsLookingAtCenter,u=p.getLookAtCenterProgressFrames,v=p.getReactionIndexOnLeft,w=p.getClusterIsMovingBackTowardCenter,x=v(s),y=0,z=c("SpatialReactionAnimationConfig").DISTANCES.FACE_FLIP_OUT_OFFSET.PX*(x?1:-1);if(t(r)){var A=u(r),B=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),C=B.LOOK_AT_CENTER.FRAMES,D=B.FACE_FLIP.FRAMES,E=B.FACE_HANG.FRAMES,F=C-D-E;return k.solve(A,y,z,C,F,E)}else if(w(r))return z;else return y},getReactionProfilePictureOffset:function q(r,s){var t=p.getLookAtCenterProgressFrames,u=p.getClusterIsLookingAtCenter,v=p.getClusterIsMovingBackTowardCenter,w=p.getReactionIndexOnLeft,x=w(s),y=0,z=c("SpatialReactionAnimationConfig").DISTANCES.MAX_PROFILE_PICTURE_OFFSET.PX*(x?1:-1);if(u(r)){var A=t(r),B=p.getDurationsForClusterType(r,c("SpatialReactionAnimationConfig")),C=B.LOOK_AT_CENTER.FRAMES,D=B.FACE_FLIP.FRAMES,E=B.FACE_HANG.FRAMES,F=C-D-E;return k.solve(A,z,-(z-y),C,F,E)}else if(v(r))return y;else return z},addTransitionEndListener:function q(r,s){return new(c("Promise"))(function(t,u){r.addEventListener(n,function(v){if(v.propertyName===s)t()})})},addTransition:function q(r,s,t,u){var v=p.addTransitionEndListener(r,t);c("CSS").addClass(r,s);u();return v},addAnimationEndListener:function q(r,s){return new(c("Promise"))(function(t,u){r.addEventListener(m,function(v){if(v.animationName===s)t()})})},addTemporaryAnimation:function q(r,s,t){return new(c("Promise"))(function(u,v){p.addAnimationEndListener(r,t).then(function(){c("CSS").removeClass(r,s);u()}).done();c("CSS").addClass(r,s)})},moveElementToPosition:function q(r,s){c("Style").set(r,"left",s.x+"px");c("Style").set(r,"top",s.y+"px")},pollForAnimationProgress:function q(r){return new(c("Promise"))(function(s,t){var u=c("setInterval")(function(){if(r()){clearInterval(u);s()}},o)})},getReactionCenterOffset:function q(r){return new(c("Vector"))(r/2,r/2)},getReactionClickPositionRelativeToViewport:function q(r,s,t){__p&&__p();var u=c("SpatialReactionAnimationConfig").SIZES.BASE.PX,v=p.getReactionCenterOffset(u),w=6,x=0;switch(t){case c("FeedbackReactionType").LOVE:x=1;break;case c("FeedbackReactionType").HAHA:x=2;break;case c("FeedbackReactionType").WOW:x=3;break;case c("FeedbackReactionType").SORRY:x=4;break;case c("FeedbackReactionType").ANGER:x=5;break;default:break}var y=s-v.y,z=v.x+u*x+w*x;return new(c("Vector"))(Math.floor(z),Math.floor(y))},isPositionIndexOnLeftSide:function q(r){return r<Math.floor(c("SpatialReactionAnimationConfig").CLICK.NUM_POSITIONS/2)},clusterIsVisibleOnLeft:function q(r,s,t,u,v,w,x){return p.clusterIsVisibleInViewport(r,s-u,t,v,w,x)},clusterIsVisibleOnRight:function q(r,s,t,u,v,w,x){return p.clusterIsVisibleInViewport(r,s+u,t,v,w,x)},clusterIsVisibleInViewport:function q(r,s,t,u,v,w){var x=p.get2dDiscretePointFromCurrentView(r.originalYaw,r.originalPitch,s,t,u,v,w),y=x.x,z=x.y;return c("SpatialReactionsUtils").isVectorWithinViewport({x:y,y:z},v,w)},get2dDiscretePointFromCurrentView:function q(r,s,t,u,v,w,x){var y=c("SphericalProjectionUtils").convert3dTo2dScaledUnique(r,s,t,u,v,w,x),z=y.x,A=y.y;return{x:Math.floor(z),y:Math.floor(A)}}};f.exports=p}),null);
__d("SpatialReactionsImageCache",["Promise","DOM","FeedbackReactionType","immutable","SpatialReactionImagePaths"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=[c("SpatialReactionImagePaths").BASES.LIKE,c("SpatialReactionImagePaths").BASES.LOVE,c("SpatialReactionImagePaths").BASES.WOW,c("SpatialReactionImagePaths").BASES.HAHA,c("SpatialReactionImagePaths").BASES.SORRY,c("SpatialReactionImagePaths").BASES.ANGER,c("SpatialReactionImagePaths").FACES.LIKE,c("SpatialReactionImagePaths").FACES.LOVE,c("SpatialReactionImagePaths").FACES.WOW,c("SpatialReactionImagePaths").FACES.HAHA,c("SpatialReactionImagePaths").FACES.SORRY,c("SpatialReactionImagePaths").FACES.ANGER];function i(){this.$SpatialReactionsImageCache1=c("immutable").Map();this.$SpatialReactionsImageCache2=c("immutable").Map();this.$SpatialReactionsImageCache3=c("immutable").Map()}i.prototype.loadStaticImages=function(j){this.$SpatialReactionsImageCache4=j;var k=h.concat(j).map(this.$SpatialReactionsImageCache5);return new(c("Promise"))(function(l,m){c("Promise").all(k).then(function(n){var o=n[0],p=n[1],q=n[2],r=n[3],s=n[4],t=n[5],u=n[6],v=n[7],w=n[8],x=n[9],y=n[10],z=n[11],A=n[12];this.$SpatialReactionsImageCache1=this.$SpatialReactionsImageCache1.set(c("FeedbackReactionType").LIKE,o).set(c("FeedbackReactionType").LOVE,p).set(c("FeedbackReactionType").WOW,q).set(c("FeedbackReactionType").HAHA,r).set(c("FeedbackReactionType").SORRY,s).set(c("FeedbackReactionType").ANGER,t);this.$SpatialReactionsImageCache2=this.$SpatialReactionsImageCache1.set(c("FeedbackReactionType").LIKE,u).set(c("FeedbackReactionType").LOVE,v).set(c("FeedbackReactionType").WOW,w).set(c("FeedbackReactionType").HAHA,x).set(c("FeedbackReactionType").SORRY,y).set(c("FeedbackReactionType").ANGER,z);this.$SpatialReactionsImageCache3=this.$SpatialReactionsImageCache3.set(j,A);l()}.bind(this),m).done()}.bind(this))};i.prototype.getReactionBaseImage=function(j){return this.$SpatialReactionsImageCache1.get(j)};i.prototype.getReactionFaceImage=function(j){return this.$SpatialReactionsImageCache2.get(j)};i.prototype.hasReactionBaseImage=function(j){return this.$SpatialReactionsImageCache1.has(j)};i.prototype.hasReactionFaceImage=function(j){return this.$SpatialReactionsImageCache2.has(j)};i.prototype.putFriendImage=function(j){return this.$SpatialReactionsImageCache6(j)};i.prototype.getFriendImage=function(j){return this.$SpatialReactionsImageCache3.get(j)};i.prototype.hasFriendImage=function(j){return this.$SpatialReactionsImageCache3.has(j)};i.prototype.getOwnProfilePhotoURI=function(){return this.$SpatialReactionsImageCache4};i.prototype.$SpatialReactionsImageCache6=function(j){return new(c("Promise"))(function(k,l){if(this.hasFriendImage(j))k(null);else this.$SpatialReactionsImageCache5(j).then(function(m){this.$SpatialReactionsImageCache3=this.$SpatialReactionsImageCache3.set(j,m);k(null)}.bind(this)).done()}.bind(this))};i.prototype.$SpatialReactionsImageCache5=function(j){return new(c("Promise"))(function(k,l){var m=c("DOM").create("img");m.onload=function(){return k(m)};m.onerror=l;m.src=j})};f.exports=new i()}),null);
__d("SpatialReactionsProductionStore",["SpatialReactionAnimationConfig","SphericalVideoComponentConstants","SphericalVideoComponentDispatcher","FluxReduceStore","SphericalViewportControlStore","immutable","Vector","UFIVideoPlayerRegistry","SpatialReactionsUtils","range"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j,k,l=c("SpatialReactionsUtils").isVectorWithinViewport,m=c("SpatialReactionAnimationConfig").CLICK.NUM_POSITIONS;h=babelHelpers.inherits(n,c("immutable").Record({shouldLeaveReactionMenuOpen:false,isMouseDown:false,isDragging:false,mousePositionRelativeToCanvas:null,nextClickReactionPositionIndex:0,originalDragPosition:null}));i=h&&h.prototype;function n(){h.apply(this,arguments)}j=babelHelpers.inherits(o,c("FluxReduceStore"));k=j&&j.prototype;o.prototype.getVideoPlayerController=function(p){var q=c("UFIVideoPlayerRegistry").getAvailableVideoPlayerController(p);if(!q)return null;return q};o.prototype.getInitialState=function(){return new n()};o.prototype.reduce=function(p,q){__p&&__p();switch(q.type){case c("SphericalVideoComponentConstants").ACTIONS.SET_SHOULD_LEAVE_REACTION_MENU_OPEN:p=p.set("shouldLeaveReactionMenuOpen",q.leaveOpen);break;case c("SphericalVideoComponentConstants").ACTIONS.SET_MOUSE_DOWN:p=this.$SpatialReactionsProductionStore1(p,q.reactionCenter);break;case c("SphericalVideoComponentConstants").ACTIONS.SET_MOUSE_UP:p=this.$SpatialReactionsProductionStore2(p,q.id,q.reactionCenter);break;case c("SphericalVideoComponentConstants").ACTIONS.SET_IS_DRAGGING:p=p.set("isDragging",q.isDragging);break;case c("SphericalVideoComponentConstants").ACTIONS.DROP_REACTION:p=p.set("mousePositionRelativeToCanvas",null);p=p.set("originalDragPosition",null);break;case c("SphericalVideoComponentConstants").ACTIONS.CLICK_REACTION:p=this.$SpatialReactionsProductionStore3(p);break;default:break}return p};o.prototype.shouldLeaveReactionMenuOpen=function(){return this.$SpatialReactionsProductionStore4(this.getState())};o.prototype.getIsMouseDown=function(){return this.$SpatialReactionsProductionStore5(this.getState())};o.prototype.getOriginalMousePosition=function(){var p=this.$SpatialReactionsProductionStore6(this.getState());if(!p)throw new Error("User is not dragging yet");return p};o.prototype.getReactionPositionVector=function(){return this.$SpatialReactionsProductionStore7(this.getState())};o.prototype.getIsReactionWithinViewport=function(p,q){return this.$SpatialReactionsProductionStore8.apply(this,[this.getState()].concat(Array.prototype.slice.call(arguments)))};o.prototype.getNextClickReactionPositionIndex=function(){return this.$SpatialReactionsProductionStore9(this.getState())};o.prototype.$SpatialReactionsProductionStore7=function(p){var q=p.mousePositionRelativeToCanvas;if(!q)throw new Error("User is not dragging yet");return q};o.prototype.$SpatialReactionsProductionStore8=function(p,q,r){var s=p.mousePositionRelativeToCanvas;if(!s)throw new Error("User is not dragging yet");return l(s,q,r)};o.prototype.$SpatialReactionsProductionStore4=function(p){return p.shouldLeaveReactionMenuOpen};o.prototype.$SpatialReactionsProductionStore5=function(p){return p.isMouseDown};o.prototype.$SpatialReactionsProductionStore6=function(p){return p.originalDragPosition};o.prototype.$SpatialReactionsProductionStore10=function(p,q){return q.sub(c("SphericalViewportControlStore").getViewportPositionVector(p))};o.prototype.$SpatialReactionsProductionStore9=function(p){return p.nextClickReactionPositionIndex};o.prototype.$SpatialReactionsProductionStore1=function(p,q){var r=new(c("Vector"))(c("SpatialReactionAnimationConfig").SIZES.BASE.PX/2,0),s=q.sub(r);p=p.set("originalDragPosition",s);p=p.set("isMouseDown",true);return p};o.prototype.$SpatialReactionsProductionStore2=function(p,q,r){p=p.set("isMouseDown",false);var s=this.$SpatialReactionsProductionStore10(q,r);p=p.set("mousePositionRelativeToCanvas",s);return p};o.prototype.$SpatialReactionsProductionStore3=function(p){var q=p.nextClickReactionPositionIndex,r=Math.floor(m/2),s=q<r,t=c("range")(0,m).filter(function(u){return s?!(u<r):u<r}).reduce(function(u,v,w,x){return u===null?x[Math.floor(Math.random()*x.length)]:u},null);return p.set("nextClickReactionPositionIndex",t)};function o(){j.apply(this,arguments)}f.exports=new o(c("SphericalVideoComponentDispatcher"))}),null);
__d("SpatialReactionsState",["immutable"],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c("immutable").Record({reactionClusters:c("immutable").Set()}));i=h&&h.prototype;function j(){"use strict";h.apply(this,arguments)}f.exports=j}),null);
__d("SpatialReactionsConsumptionStore",["invariant","SpatialReactionAnimationConfig","SpatialReactionAnimationUtils","SphericalVideoComponentConstants","SphericalVideoComponentDispatcher","FluxMapStore","SpatialReactionsImageCache","immutable","SpatialReaction","SpatialReactionCluster","SpatialReactionsState","SpatialReactionsProductionStore","VideoPlayerControllerStore","SpatialReactionExperimentsStore","SphericalViewportControlStore","curry","denormalizeYaw","degToRad","radToDeg","SphericalProjectionUtils"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalProjectionUtils").distanceBetweenSphericalCoordinatesDeg,l=c("SpatialReactionAnimationConfig").DURATIONS.SELF.TOTAL.FRAMES,m=.7;i=babelHelpers.inherits(n,c("FluxMapStore"));j=i&&i.prototype;n.prototype.getInitialState=function(){return c("immutable").Map({})};n.prototype.reduce=function(o,p){__p&&__p();var q=p.id,r=c("curry")(o.set.bind(o),q);switch(p.type){case c("SphericalVideoComponentConstants").ACTIONS.REGISTER_NEW_REACTIONS_STATE:o=r(new(c("SpatialReactionsState"))());break;case c("SphericalVideoComponentConstants").ACTIONS.ADD_SPATIAL_REACTIONS:o=this.$SpatialReactionsConsumptionStore1(q,o,p.reactionClusters);break;case c("SphericalVideoComponentConstants").ACTIONS.DROP_REACTION:o=this.$SpatialReactionsConsumptionStore2(q,o,p.reactionType,p.reactionOutsideViewport,p.recordMouseLocation,p.viewportWidth,p.viewportHeight,p.viewportYaw,p.viewportPitch,p.viewportFieldOfView,p.recordReactionCallback);break;case c("SphericalVideoComponentConstants").ACTIONS.TICK_ANIMATION:o=this.$SpatialReactionsConsumptionStore3(q,o);o=this.$SpatialReactionsConsumptionStore4(q,o);break;case c("SphericalVideoComponentConstants").ACTIONS.START_ANIMATION_FOR_FRAME:o=this.$SpatialReactionsConsumptionStore5(q,o,p.timestamp,p.yaw,p.pitch,p.fieldOfView,p.viewportWidth,p.viewportHeight);break;case c("SphericalVideoComponentConstants").ACTIONS.SEEK_START:o=this.$SpatialReactionsConsumptionStore6(q,o);break;default:break}return o};n.prototype.getSpatialReactionsState=function(o){return this.$SpatialReactionsConsumptionStore7(o,this.getState())};n.prototype.$SpatialReactionsConsumptionStore7=function(o,p){return p.get(o)};n.prototype.$SpatialReactionsConsumptionStore8=function(o,p,q,r){var s=p.get(o).set(q,r);return p.set(o,s)};n.prototype.$SpatialReactionsConsumptionStore2=function(o,p,q,r,s,t,u,v,w,x,y){if(r||c("SpatialReactionExperimentsStore").shouldDisableReactions(o)){y();return p}y(Math.floor(v),Math.floor(w));return this.$SpatialReactionsConsumptionStore9(o,p,q,v,w,c("VideoPlayerControllerStore").getCurrentTime(o))};n.prototype.$SpatialReactionsConsumptionStore9=function(o,p,q,r,s,t){var u=c("SpatialReactionsImageCache").getOwnProfilePhotoURI();if(!u)return p;var v=p.get(o),w=new(c("SpatialReactionCluster"))({animationDurationFrames:l,animationProgressFrames:-1,friendReactions:c("immutable").Set.of(new(c("SpatialReaction"))({animationRandomSeed:Math.random(),isFriend:true,profilePictureURI:u,reactionType:q,positionIndex:c("SpatialReactionsProductionStore").getNextClickReactionPositionIndex()})),originalYaw:c("denormalizeYaw")(r),originalPitch:s,timestamp:t,isSelfReaction:true});p=p.set(o,v);return this.$SpatialReactionsConsumptionStore1(o,p,c("immutable").Set.of(w))};n.prototype.$SpatialReactionsConsumptionStore1=function(o,p,q){__p&&__p();var r=p.get(o),s=r,t=s.reactionClusters;q.forEach(function(u){var v=u.friendReactions;v.forEach(function(w){w.profilePictureURI||h(0);w.isFriend||h(0);c("SpatialReactionsImageCache").putFriendImage(w.profilePictureURI)})});t=t.union(q);r=r.set("reactionClusters",t);return p.set(o,r)};n.prototype.$SpatialReactionsConsumptionStore5=function(o,p,q,r,s,t,u,v){__p&&__p();var w=c("SpatialReactionAnimationUtils").canStartClusterAnimation,x=c("SpatialReactionAnimationUtils").clusterIsVisibleOnLeft,y=c("SpatialReactionAnimationUtils").clusterIsVisibleOnRight,z=c("SpatialReactionAnimationUtils").clusterIsVisibleInViewport,A=p.get(o),B=A.reactionClusters,C=c("SpatialReactionExperimentsStore").shouldDisableInitialViewportReactions(o),D=k(c("SphericalViewportControlStore").getInitialYaw(o),c("SphericalViewportControlStore").getInitialPitch(o),r,s),E=D<30,F=c("SpatialReactionExperimentsStore").shouldOnlyShowHints(o),G=B.count(function(K){return K.hasStartedAnimating()&&!K.isSelfReaction}),H=u/v,I=c("radToDeg")(2*Math.atan(Math.tan(c("degToRad")(t)/2)*H)),J=function J(K){__p&&__p();var L=K;if(w(q,K,c("SpatialReactionsImageCache")))if(K.isSelfReaction)L=K.startAnimation(r,s);else if(G<1)if(z(K,r,s,t,u,v)){if(!(F||C&&E))L=K.startAnimation(r,s)}else if(x(K,r,s,I,t,u,v)){var M=true;L=K.startAnimation(r-I*m,s,M)}else if(y(K,r,s,I,t,u,v)){var N=true;L=K.startAnimation(r+I*m,s,N)}return L};return this.$SpatialReactionsConsumptionStore10(o,p,J)};n.prototype.$SpatialReactionsConsumptionStore3=function(o,p){var q=function q(r){return r.hasStartedAnimating()?r.tickAnimation():r};return this.$SpatialReactionsConsumptionStore10(o,p,q)};n.prototype.$SpatialReactionsConsumptionStore4=function(o,p){var q=c("SpatialReactionAnimationUtils").resetClusterAnimationIfNeeded;p=this.$SpatialReactionsConsumptionStore10(o,p,q);return p};n.prototype.$SpatialReactionsConsumptionStore6=function(o,p){return this.$SpatialReactionsConsumptionStore10(o,p,c("SpatialReactionAnimationUtils").resetClusterAnimation)};n.prototype.$SpatialReactionsConsumptionStore10=function(o,p,q){var r=p.get(o),s=r,t=s.reactionClusters;t=t.map(q);r=r.set("reactionClusters",t);return p.set(o,r)};n.prototype.$SpatialReactionsConsumptionStore11=function(o,p,q){var r=p.get(o),s=r,t=s.reactionClusters;t=t.filter(q);r=r.set("reactionClusters",t);return p.set(o,r)};function n(){i.apply(this,arguments)}f.exports=new n(c("SphericalVideoComponentDispatcher"))}),null);
__d("SpatialReactionsConsumptionLoggingStore",["invariant","SphericalVideoComponentConstants","SphericalVideoComponentDispatcher","FluxMapStore","immutable","SpatialReactionsConsumptionStore","SphericalViewportControlStore","SpatialReactionConsumptionTypedLogger","SpatialReactionConsumptionLoggingEvents","SpatialReactionDisplayStates"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k,l,m=100,n=Math.floor;i=babelHelpers.inherits(o,c("immutable").Record({clusterPitch:null,clusterYaw:null,displayState:null,friendCount:0,hasNonFriend:false,isDisplayingCluster:false,moveTowardHint:false,reactionType:null,timestamp:null,viewportPitch:null,viewportYaw:null}));j=i&&i.prototype;function o(){i.apply(this,arguments)}k=babelHelpers.inherits(p,c("FluxMapStore"));l=k&&k.prototype;p.prototype.getInitialState=function(){return c("immutable").Map({})};p.prototype.reduce=function(q,r){var s=r.id;switch(r.type){case c("SphericalVideoComponentConstants").ACTIONS.REGISTER_NEW_REACTIONS_STATE:q=q.set(s,new o());break;case c("SphericalVideoComponentConstants").ACTIONS.TICK_ANIMATION:q=this.$SpatialReactionsConsumptionLoggingStore1(q,s);break;default:break}return q};p.prototype.$SpatialReactionsConsumptionLoggingStore1=function(q,r){__p&&__p();var s=this.$SpatialReactionsConsumptionLoggingStore2(r,q),t=s.isDisplayingCluster,u=c("SpatialReactionsConsumptionStore").getSpatialReactionsState(r);if(u){var v=u.get("reactionClusters"),w=v.filter(function(y){return!y.isSelfReaction&&y.hasStartedAnimating()}),x=w.size>0;if(x&&!t)q=this.$SpatialReactionsConsumptionLoggingStore3(r,q,v);else if(!x&&t){q=this.$SpatialReactionsConsumptionLoggingStore4(r,q);this.$SpatialReactionsConsumptionLoggingStore5(q.get(r));q=this.$SpatialReactionsConsumptionLoggingStore6(r,q)}}return q};p.prototype.$SpatialReactionsConsumptionLoggingStore3=function(q,r,s){__p&&__p();var t=s.filter(function(u){return!u.isSelfReaction&&u.hasStartedAnimating()});if(t.size===1){var u=t.first(),v=u.animationYaw,w=u.animationPitch,x=u.friendReactions,y=u.anonymousReactions,z=u.timestamp;v!==null&&w!==null||h(0);var A=c("SphericalViewportControlStore").getOrientation(q),B=this.$SpatialReactionsConsumptionLoggingStore2(q,r),C=x.union(y).countBy(function(G){return G.reactionType}).sortBy(function(G,H){return-G}).flip().first(),D=x.size,E=y.size>0,F=u.isHint?c("SpatialReactionDisplayStates").HINT:c("SpatialReactionDisplayStates").DISPLAY;B=B.set("isDisplayingCluster",true).set("clusterYaw",n(v)).set("clusterPitch",n(w)).set("timestamp",n(z)).set("reactionType",C).set("friendCount",D).set("hasNonFriend",E).set("viewportYaw",n(A.yaw)).set("viewportPitch",n(A.pitch)).set("displayState",F);r=r.set(q,B)}return r};p.prototype.$SpatialReactionsConsumptionLoggingStore4=function(q,r){var s=this.$SpatialReactionsConsumptionLoggingStore2(q,r);if(s.displayState===c("SpatialReactionDisplayStates").HINT){var t=c("SphericalViewportControlStore").getOrientation(q),u=s,v=u.viewportYaw,w=u.viewportPitch,x=u.clusterYaw,y=u.clusterPitch;v!==null&&w!==null&&x!==null&&y!==null||h(0);var z=this.$SpatialReactionsConsumptionLoggingStore7(v-x,w-y),A=this.$SpatialReactionsConsumptionLoggingStore7(t.yaw-x,t.pitch-y);s=s.set("moveTowardHint",z-A>m)}r=r.set(q,s);return r};p.prototype.$SpatialReactionsConsumptionLoggingStore7=function(q,r){return r*r+q*q};p.prototype.$SpatialReactionsConsumptionLoggingStore6=function(q,r){return r.set(q,new o())};p.prototype.$SpatialReactionsConsumptionLoggingStore5=function(q){var r=new(c("SpatialReactionConsumptionTypedLogger"))();r.setEvent(c("SpatialReactionConsumptionLoggingEvents").SPATIAL_REACTION_DISPLAY).setYaw(q.get("clusterYaw")).setPitch(q.get("clusterPitch")).setDisplayState(q.get("displayState")).setFriendCount(q.get("friendCount")).setHasNonFriend(q.get("hasNonFriend")).setMoveTowardsHint(q.get("moveTowardHint")).setReactionKey(q.get("reactionType")).setVideoTimestamp(q.get("timestamp")).setCenterYaw(q.get("viewportYaw")).setCenterPitch(q.get("viewportPitch"));r.log();r.clear()};p.prototype.$SpatialReactionsConsumptionLoggingStore2=function(q,r){return r.get(q)};p.prototype.finishTrackingCluster=function(q,r){return this.$SpatialReactionsConsumptionLoggingStore4(q,r)};function p(){k.apply(this,arguments)}f.exports=new p(c("SphericalVideoComponentDispatcher"))}),null);
__d("SphericalVideoComponent",["SphericalVideoComponentActions","SphericalVideoComponentDispatcher","VideoPlayerControllerStore","SphericalViewportControlStore","SpatialReactionsConsumptionStore","SpatialReactionsProductionStore","SpatialReactionFunnelLoggingStore","SpatialReactionsConsumptionLoggingStore","SpatialReactionExperimentsStore","abstractMethod"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();h.getStores=function(){return[c("VideoPlayerControllerStore"),c("SphericalViewportControlStore"),c("SpatialReactionsConsumptionStore"),c("SpatialReactionsProductionStore"),c("SpatialReactionFunnelLoggingStore"),c("SpatialReactionsConsumptionLoggingStore"),c("SpatialReactionExperimentsStore")]};h.prototype.getInitialState=function(i){return c("abstractMethod")("SphericalVideoComponent","getInitialState")};h.prototype.calculateState=function(i){return c("abstractMethod")("SphericalVideoComponent","calculateState")};function h(i){__p&&__p();this.onStoreChange=function(){var o=this.calculateState(this.state);this.onStateChange(this.state,o);this.state=o}.bind(this);c("SphericalVideoComponentDispatcher").explicitlyRegisterStores([c("SphericalViewportControlStore"),c("VideoPlayerControllerStore"),c("SpatialReactionsConsumptionStore"),c("SpatialReactionsProductionStore"),c("SpatialReactionFunnelLoggingStore"),c("SpatialReactionsConsumptionLoggingStore"),c("SpatialReactionExperimentsStore")]);this.id=i.getVideoPlayerID();c("SphericalVideoComponentActions").registerVideoPlayerController(i);this.state=this.getInitialState(this.id);for(var j=h.getStores(),k=Array.isArray(j),l=0,j=k?j:j[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=j.length)break;m=j[l++]}else{l=j.next();if(l.done)break;m=l.value}var n=m;n.addListener(this.onStoreChange)}}h.prototype.onStateChange=function(i,j){return};f.exports=h}),null);
__d("SpatialReactionClickAnimation",["SphericalVideoComponentActions","SphericalVideoComponent","SphericalViewportControlStore","curry"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i;h=babelHelpers.inherits(j,c("SphericalVideoComponent"));i=h&&h.prototype;function j(k,l,m){i.constructor.call(this,k);this.$SpatialReactionClickAnimation1=l;this.$SpatialReactionClickAnimation2=m}j.prototype.getInitialState=function(k){var l=c("SphericalViewportControlStore").getState().get("sphericalViewportControlStates").get(k),m=l.yaw,n=l.pitch,o=l.fieldOfView,p=l.viewportWidth,q=l.viewportHeight;return{viewportFieldOfView:o,viewportHeight:q,viewportPitch:n,viewportWidth:p,viewportYaw:m}};j.prototype.calculateState=function(k){return this.getInitialState(this.id)};j.prototype.click=function(event){var k=this.id;c("SphericalVideoComponentActions").clickReaction(k,this.$SpatialReactionClickAnimation1);c("SphericalVideoComponentActions").togglePlay(k,true);c("SphericalVideoComponentActions").dropReaction(k,this.$SpatialReactionClickAnimation1,false,false,this.state.viewportWidth,this.state.viewportHeight,this.state.viewportYaw,this.state.viewportPitch,this.state.viewportFieldOfView,c("curry")(this.$SpatialReactionClickAnimation2,event))};f.exports=j}),null);
__d("SpatialReactionDragPositioner",["SpatialReactionAnimationConfig","Vector","VelocityTracker","getElementPosition","Scroll"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("SpatialReactionAnimationConfig").DRAG.FRICTION_COEFFICIENT;function i(j){this.$SpatialReactionDragPositioner1=j;this.$SpatialReactionDragPositioner3=new(c("VelocityTracker"))()}i.prototype.updateMousePosition=function(j){if(!this.$SpatialReactionDragPositioner2){var k=c("getElementPosition")(this.$SpatialReactionDragPositioner1),l=k.x,m=k.y,n=c("Scroll").getTop(document.body);this.$SpatialReactionDragPositioner2=new(c("Vector"))(l,m+n,"document")}this.$SpatialReactionDragPositioner2.x+=(j.x-this.$SpatialReactionDragPositioner2.x)*h;this.$SpatialReactionDragPositioner2.y+=(j.y-this.$SpatialReactionDragPositioner2.y)*h;this.$SpatialReactionDragPositioner4(this.$SpatialReactionDragPositioner2)};i.prototype.$SpatialReactionDragPositioner4=function(j){j.setElementPosition(this.$SpatialReactionDragPositioner1);this.$SpatialReactionDragPositioner3.update(j.x,j.y)};i.prototype.getVelocityVector=function(){return new(c("Vector"))(this.$SpatialReactionDragPositioner3.getVelocityX(),this.$SpatialReactionDragPositioner3.getVelocityY())};i.prototype.getVelocityMagnitude=function(){return this.$SpatialReactionDragPositioner3.getSpeed()};f.exports=i}),null);
__d("SpatialReactionDraggable",["cx","SphericalVideoComponentActions","SpatialReactionAnimationConfig","CSS","DOM","Draggable","SpatialReactionDragPositioner","SpatialReactionsProductionStore","SphericalVideoComponent","SphericalViewportControlStore","Style","Vector","VideoPlayerControllerStore","throttle","curry","SpatialReactionsUtils","SpatialReactionAnimationUtils"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SpatialReactionsUtils").getReactionCenterVector,l=c("SpatialReactionsUtils").insertOnTop,m=c("SpatialReactionAnimationUtils").addAnimationEndListener,n=c("SpatialReactionAnimationUtils").addTemporaryAnimation,o=c("SpatialReactionAnimationUtils").addTransitionEndListener,p=c("SpatialReactionAnimationUtils").getPercentageWithMax,q=c("SpatialReactionAnimationUtils").moveElementToPosition,r=c("SpatialReactionAnimationUtils").pollForAnimationProgress,s=10,t=c("SpatialReactionAnimationConfig").DRAG.FACE.OFFSET.LOVE.PX,u=c("SpatialReactionAnimationConfig").DRAG.FACE.SCALE.MIN;i=babelHelpers.inherits(v,c("SphericalVideoComponent"));j=i&&i.prototype;function v(x,y,z,A,B){j.constructor.call(this,y);w.call(this);this.$SpatialReactionDraggable2=this.$SpatialReactionDraggable8(this.$SpatialReactionDraggable9());this.$SpatialReactionDraggable3=this.$SpatialReactionDraggable2.getDOM();this.$SpatialReactionDraggable7=z;this.$SpatialReactionDraggable1=A;this.$SpatialReactionDraggable4=B}v.prototype.getInitialState=function(x){var y=c("SphericalViewportControlStore").getState().get("sphericalViewportControlStates").get(x),z=y.yaw,A=y.pitch,B=y.fieldOfView,C=y.viewportWidth,D=y.viewportHeight;return{viewportFieldOfView:B,viewportHeight:D,viewportPitch:A,viewportWidth:C,viewportYaw:z}};v.prototype.calculateState=function(x){return this.getInitialState(this.id)};v.prototype.onStateChange=function(x,y){return};v.prototype.getDOMNode=function(){return this.$SpatialReactionDraggable3};v.prototype.insertIntoDOM=function(x){l(x,this.$SpatialReactionDraggable3,s);n(this.$SpatialReactionDraggable3,"_2khb","dragStartAnimation")};v.prototype.startDragging=function(){this.$SpatialReactionDraggable2.triggerMouseDown(this.$SpatialReactionDraggable1.nativeEvent)};v.prototype.$SpatialReactionDraggable9=function(){var x=c("DOM").create("span",{className:"_5_0x"}),y=c("DOM").create("span",{className:"_5_0y"});this.$SpatialReactionDraggable6=y;c("DOM").appendContent(x,y);return x};v.prototype.$SpatialReactionDraggable8=function(x){this.$SpatialReactionDraggable5=new(c("SpatialReactionDragPositioner"))(x);return new(c("Draggable"))(x).setNamespace("SpatialReactionDraggable").setUseAbsolute(true).setManualPositioner(this.$SpatialReactionDraggable5).setGrabHandler(this.$SpatialReactionDraggable10).setDragHandler(c("throttle")(this.$SpatialReactionDraggable11,c("SpatialReactionAnimationConfig").DRAG.THROTTLE_INTERVAL.MS)).setDropHandler(c("curry")(this.$SpatialReactionDraggable12,this.$SpatialReactionDraggable5))};v.prototype.$SpatialReactionDraggable14=function(){return p(this.$SpatialReactionDraggable5.getVelocityMagnitude(),c("SpatialReactionAnimationConfig").DRAG.VELOCITY.MAX)};v.prototype.$SpatialReactionDraggable13=function(){var x=this.$SpatialReactionDraggable5.getVelocityVector(),y=x.x,z=x.y,A=Math.max(Math.abs(y),Math.abs(z));return new(c("Vector"))(A>0?y/A:0,A>0?z/A:0)};v.prototype.$SpatialReactionDraggable15=function(x,y){var z=x.x*y*t,A=x.y*y*t,B=1-u,C=1-y*B;c("Style").set(this.$SpatialReactionDraggable6,"transform","translate("+z+"px, "+A+"px) scale("+C+")")};var w=function w(){__p&&__p();this.removeFromDOM=function(){return c("DOM").remove(this.$SpatialReactionDraggable3)}.bind(this);this.$SpatialReactionDraggable10=function(x){var y=c("VideoPlayerControllerStore").getIsPlaying(this.id),z=k(this.$SpatialReactionDraggable3);c("SphericalVideoComponentActions").setMouseDown(this.id,z,y);c("SphericalVideoComponentActions").setShouldLeaveReactionMenuOpen(this.id,true)}.bind(this);this.$SpatialReactionDraggable11=function(){c("SphericalVideoComponentActions").setIsDragging(this.id,true);var x=this.$SpatialReactionDraggable13(),y=this.$SpatialReactionDraggable14();this.$SpatialReactionDraggable15(x,y)}.bind(this);this.$SpatialReactionDraggable12=function(x){__p&&__p();var y=this.state,z=y.viewportYaw,A=y.viewportPitch,B=y.viewportFieldOfView,C=y.viewportWidth,D=y.viewportHeight,E=this.$SpatialReactionDraggable3,F=c("curry")(c("CSS").addClass,E),G=c("curry")(c("Style").set,E),H=k(E),I=c("curry")(this.$SpatialReactionDraggable4,this.$SpatialReactionDraggable1),J=function(){return c("SphericalVideoComponentActions").setShouldLeaveReactionMenuOpen(this.id,false)}.bind(this);c("SphericalVideoComponentActions").setIsDragging(this.id,false,H);c("SphericalVideoComponentActions").setMouseUp(this.id,H);var K=!c("SpatialReactionsProductionStore").getIsReactionWithinViewport(C,D),L=function(){c("SphericalVideoComponentActions").dropReaction(this.id,this.$SpatialReactionDraggable7,K,true,C,D,z,A,B,I)}.bind(this);if(K){o(E,"top").then(function(){L();this.removeFromDOM();J()}.bind(this)).done();F("_1b5r");q(E,c("SpatialReactionsProductionStore").getOriginalMousePosition());G("transform",c("SpatialReactionAnimationConfig").DRAG.ORIGINAL_SCALE_VALUE)}else{J();m(E,"dragSuccessAnimation").then(this.removeFromDOM).done();var M=function M(){var N=E.getBoundingClientRect().width/E.offsetWidth;return N<c("SpatialReactionAnimationConfig").SCALES.COIN_FLIP_MORPH_START};r(M).then(L).done();F("_3peq")}}.bind(this)};f.exports=v}),null);
__d("UFIReactionsSpatialReactionIconContainer.react",["cx","React","ReactDOM","SpatialReactionAnimationConfig","SpatialReactionClickAnimation","SpatialReactionDraggable","SpatialReactionsProductionStore","SphericalVideoExperiments"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SpatialReactionsProductionStore").getVideoPlayerController,l=c("SphericalVideoExperiments").spatialReactionsDragEnabled;i=babelHelpers.inherits(m,c("React").PureComponent);j=i&&i.prototype;function m(){__p&&__p();var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.onMouseDown=function(event){__p&&__p();if(!l)return true;event.persist();event.preventDefault();var s=k(this.props.instanceId);if(s){var t=function(){this.$SpatialReactionIconContainer1=new(c("SpatialReactionDraggable"))(this.$SpatialReactionIconContainer2,s,this.props.reactionType,event,this.props.onDrop);this.$SpatialReactionIconContainer1.insertIntoDOM(this.$SpatialReactionIconContainer2);this.$SpatialReactionIconContainer1.startDragging()}.bind(this);clearTimeout(this.$SpatialReactionIconContainer3);this.$SpatialReactionIconContainer3=setTimeout(t,c("SpatialReactionAnimationConfig").DRAG.THRESHOLD.MS)}return false}.bind(this),this.onClick=function(event){__p&&__p();clearTimeout(this.$SpatialReactionIconContainer3);event.persist();event.preventDefault();event.stopPropagation();if(!this.$SpatialReactionIconContainer4){var s=k(this.props.instanceId);if(s)this.$SpatialReactionIconContainer4=new(c("SpatialReactionClickAnimation"))(s,this.props.reactionType,this.props.onDrop);else return}this.$SpatialReactionIconContainer4.click(event)}.bind(this),o}m.prototype.componentDidMount=function(){this.$SpatialReactionIconContainer2=c("ReactDOM").findDOMNode(this)};m.prototype.componentWillUnmount=function(){clearTimeout(this.$SpatialReactionIconContainer3)};m.prototype.onMouseUp=function(event){event.stopPropagation()};m.prototype.render=function(){var n="_1fq9";return c("React").createElement("span",{className:n,onClick:this.onClick,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp},this.props.children)};f.exports=m}),null);
__d("UFIReactionsMenuImpl.react",["cx","fbt","Event","Locale","React","ReactDOM","RTLKeys","SubscriptionsHandler","UFIConfig","UFIReactionIconImpl.react","UFIReactionsDialogLayerImpl.react","UFIReactionsSpatialReactionIconContainer.react","UFIReactionTypes","addFocusEvents","getVendorPrefixedName","joinClasses","shallowCompare"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j,k,l=8,m=96,n=48,o=44,p=39,q=c("UFIReactionTypes").reactions,r=c("getVendorPrefixedName")("transform"),s=i._("Reactions"),t=c("addFocusEvents")("span");j=babelHelpers.inherits(u,c("React").Component);k=j&&j.prototype;function u(v,w){"use strict";__p&&__p();k.constructor.call(this);this.focusSelected=function(){var z=c("ReactDOM").findDOMNode(this.refs[this.state.selectedIndex]);if(z)z.focus()}.bind(this);this.onLayerRender=function(){if(this.state.hasKeyboardFocus)this.focusSelected()}.bind(this);this.onKeyDown=function(event){__p&&__p();switch(event.keyCode){case c("RTLKeys").RETURN:event.preventDefault();var z=this.state.supportedReactions[this.state.selectedIndex];if(this.props.initialReaction===z)z=c("UFIReactionTypes").NONE;if(z!==null&&z!==undefined&&this.props.onReactionClick)this.props.onReactionClick(z,event);break;case c("RTLKeys").getLeft():case c("RTLKeys").getRight():event.preventDefault();this.setState({selectedIndex:Math.max(0,Math.min(this.state.selectedIndex+(event.keyCode===c("RTLKeys").getLeft()?-1:1),this.state.supportedReactions.length-1))},this.focusSelected);break}}.bind(this);var x=v.supportedReactions.filter(function(z){return q[z]}),y=v.allowKeyboardFocus?Math.max(0,x.indexOf(v.initialReaction)):-1;this.state={hasKeyboardFocus:v.allowKeyboardFocus,shouldRenderMenu:v.shown,selectedIndex:y,supportedReactions:x};this.hasStaticSVGDock=c("UFIConfig").reactionsHasStaticFileVectorDock;this.hasAnimatedIcons=c("UFIConfig").reactionsHasAnimatedIcons;this.onlyAnimateIconsOnHover=c("UFIConfig").reactionsOnlyAnimateIconsOnHover;this.animatedIconSizing=c("UFIConfig").reactionsAnimatedIconSizing||"original";this.animatedIconsUsePackage=c("UFIConfig").reactionsAnimatedIconsUsePackage||false}u.prototype.componentWillReceiveProps=function(v){"use strict";if(!this.state.shouldRenderMenu&&v.shown)this.setState({shouldRenderMenu:true});if(!v.shown&&this.props.shown)this.setState({hasKeyboardFocus:v.allowKeyboardFocus,selectedIndex:-1});this.setState({supportedReactions:v.supportedReactions.filter(function(w){return q[w]})})};u.prototype.componentDidMount=function(){"use strict";if(this.props.allowKeyboardFocus)this.focusSelected()};u.prototype.componentDidUpdate=function(v,w){"use strict";__p&&__p();if(this.props.allowKeyboardFocus&&!v.allowKeyboardFocus)this.focusSelected();if(this.props.isLongPressing&&!v.isLongPressing){var x,y=new(c("SubscriptionsHandler"))();y.addSubscriptions(c("Event").listen(document.documentElement,"touchmove",function(event){__p&&__p();event.preventDefault();var z=event.touches[0],A=document.elementFromPoint(z.clientX,z.clientY);if(!A.getAttribute("data-reaction")&&A.parentElement)A=A.parentElement;var B=parseInt(A.getAttribute("data-reaction"),10)||null;if(B!==x){if(x)this.onReactionMouseLeave(x,event);if(B)this.onReactionMouseEnter(B,event);x=B}}.bind(this)),c("Event").listen(document.documentElement,"touchend",function(event){if(x)this.onReactionClick(x,event);if(y){y.release();y=null}}.bind(this)))}};u.prototype.shouldComponentUpdate=function(v,w){"use strict";return c("shallowCompare")(this,v,w)};u.prototype.onDragStart=function(event){"use strict";event.preventDefault()};u.prototype.onKeyboardFocus=function(v,event){"use strict";this.setState({hasKeyboardFocus:true,selectedIndex:v});this.props.onFocus&&this.props.onFocus(event)};u.prototype.onReactionClick=function(v,event){var w,x=arguments.length<=2||arguments[2]===undefined?null:arguments[2],y=arguments.length<=3||arguments[3]===undefined?null:arguments[3];"use strict";event.preventDefault();this.props.onReactionClick&&(w=this.props).onReactionClick.apply(w,arguments)};u.prototype.onReactionMouseEnter=function(v,event){"use strict";this.setState({selectedIndex:this.props.supportedReactions.indexOf(v)});this.props.onReactionMouseEnter&&this.props.onReactionMouseEnter(v)};u.prototype.onReactionMouseLeave=function(v,event){"use strict";this.setState({selectedIndex:-1});this.props.onReactionMouseLeave&&this.props.onReactionMouseLeave(v)};u.prototype.render=function(){"use strict";__p&&__p();var v=this.state.supportedReactions.length,w=this.props.showSpatialReactions,x=(v*n-m)/(v-1),y=this.state.selectedIndex,z=this.state.supportedReactions.map(function(A,B){var C=q[A].display_name,D=this.onReactionClick.bind(this,A),E=Math.max(0,this.state.supportedReactions.indexOf(this.props.initialReaction))===B,F=this.props.icon,G=this.hasAnimatedIcons&&F&&F.supportsReaction&&F.supportsReaction(A),H=void 0;if(G){var I=y===B,J=!c("UFIConfig").reactionsAnimatedIconsNoPlayback&&this.props.allowAnimationPlayback&&this.props.shown&&(!this.onlyAnimateIconsOnHover||I),K=this.animatedIconSizing==="native-small"?p:this.animatedIconSizing==="native-both"?I?n:p:n;H=c("React").createElement(F,{animate:J,className:"_1ef0",selectedIndex:this.state.selectedIndex,maxSize:K,reactionID:A,usePackage:this.animatedIconsUsePackage})}else H=c("React").createElement(c("UFIReactionIconImpl.react"),{className:"_2jry",reaction:A,size:"48",hasStaticSVGDock:this.hasStaticSVGDock});if(w)H=c("React").createElement(c("UFIReactionsSpatialReactionIconContainer.react"),{instanceId:this.props.instanceId,reactionType:A,onDrop:D},H);return c("React").createElement(t,{"aria-pressed":this.props.initialReaction===A,"aria-label":C,className:"_iuw"+(y===B?" _iuy":""),href:"#",key:"reaction_"+A,onClick:D,onDragStart:this.onDragStart,onKeyboardFocus:this.onKeyboardFocus.bind(this,B),onMouseUp:this.props.onReactionMouseUp,onMouseDown:this.props.onReactionMouseDown,onMouseEnter:this.onReactionMouseEnter.bind(this,A),onMouseLeave:this.onReactionMouseLeave.bind(this,A),onTouchStart:this.onDragStart,onTouchEnd:D,ref:B,role:"button",tabIndex:E&&(!this.props.shown||y===B)?0:-1},c("React").createElement("div",{className:"_39m"+(w?" _4x7a":"")+(G?" _1ef2":""),"data-reaction":A},c("React").createElement("div",{className:"_39n"},H,c("React").createElement("div",{className:"_d6l"},c("React").createElement("div",{className:"_4sm1"},C)))))}.bind(this));if(!this.state.shouldRenderMenu)return null;return c("React").createElement(c("UFIReactionsDialogLayerImpl.react"),{height:o+l,isDarkBackground:this.props.isDarkBackground,isScreenReader:this.props.isScreenReader,onLayerBlur:this.props.onBlur,onLayerRender:this.onLayerRender,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,noBackground:this.props.noBackground,shown:this.props.shown},c("React").createElement("div",{className:c("joinClasses")("_iu-"+(this.state.hasKeyboardFocus?" _5wkt":"")+(this.animatedIconSizing==="native-small"?" _628b":"")+(this.animatedIconSizing==="native-both"?" _628c":""),this.props.className),onKeyDown:this.onKeyDown,"aria-label":s,ref:"root",role:"toolbar"},z))};f.exports=u}),null);